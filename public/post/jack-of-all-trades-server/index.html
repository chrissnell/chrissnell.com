	<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> The Jack-of-All-Trades Home Server &middot; Chris Snell </title>

  
  <link rel="stylesheet" href="https://chrissnell.com/css/poole.css">
  <link rel="stylesheet" href="https://chrissnell.com/css/syntax.css">
  <link rel="stylesheet" href="https://chrissnell.com/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|EB+Garamond|Inconsolata">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://chrissnell.com/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://chrissnell.com/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Chris Snell" />
</head>

	<body class="theme-base-0g">
		<div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <a href="https://chrissnell.com/"><h1>Chris Snell</h1></a>
      <p class="lead">
       Love of family, code, and old Land Rovers 
      </p>
      <div class="sidebar-links">
        <h3 class="links">github: <a href="https://github.com/chrissnell">chrissnell</a></h3>
        <h3 class="links">twitter: <a href="https://twitter.com/chrissnell">@chrissnell</a></h3>
     </div>
 </div>
    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>


		<div class="content container">
			<div class="post">
			 	<h1>The Jack-of-All-Trades Home Server</h1>
			  <span class="post-date">Tue, Dec 31, 2013</span>
			      <p>I&rsquo;ve been wanting to build a server for my home for a while and I finally got around to it over the holidays. &nbsp; My goal was to ditch all of the aging equipment in my office and consolidate it into one powerful, do-it-all machine. &nbsp;It took several days of hacking to get it all working but now it lives:</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/server.jpg" />
    
    
    <figcaption>
        <h4>The Server</h4>
        
    </figcaption>
    
</figure>


<p><strong>Consolidation</strong></p>

<p>Before this server, I had a bunch of old, crap hardware running in my office. &nbsp;The gear was a decade old and couldn&rsquo;t keep up with modern Internet speeds and the new applications. &nbsp; I decided to use VMware&rsquo;s (free!) <a href="http://www.vmware.com/products/vsphere-hypervisor/overview.html">ESXi hypervisor</a> to consolidate all of this old junk onto one box. &nbsp; Onto this one server, I consolidated:</p>

<ul>
<li>Software development server (<a href="http://www.ubuntu.com/">Ubuntu Linux</a>)</li>
<li>Password+Wireless cracking/Security server (<a href="http://backtrack-linux.org/">Backtrack Linux</a>)</li>
<li>Media server (<a href="http://freebsd.org">FreeBSD</a>)</li>
<li>Firewall + VPN (<a href="http://www.pfsense.org">pfSense</a>)&nbsp;</li>
</ul>

<p>To run all of these things and run them well, I needed some big iron. &nbsp;Here&rsquo;s what I built:</p>

<ul>
<li><a href="http://www.supermicro.com/products/motherboard/xeon/c600/x9srh-7f.cfm">Supermicro X9SRH-7F</a> server-class motherboard</li>
<li>Intel Xeon E5-2620 hex-core server-class CPU</li>
<li>32 GB Kingston DDR3 1600 MHz ECC RAM</li>
<li>4 x 2 TB Western Digital &ldquo;Red&rdquo; server-class hard disks (RAID 10)</li>
<li><a href="Gigabyte/AMD%20Radeon%20HD7970">Gigabyte/AMD Radeon HD7970</a> video card (for GPU-assisted password cracking, more on that later&hellip;)</li>
<li>Intel I340-T4 quad-port 1000 Mbit ethernet adapter (PCIe)</li>
<li>Corsair HX1050 power supply (1050 Watt)</li>
<li>Supermicro CPU heatsink for narrow-profile LGA2011 CPU</li>
<li>Corsair 600T mid-tower case</li>
</ul>

<p>This machine is a monster. &nbsp; Even running all of these virtual servers, its resources aren&rsquo;t even 10% utilized.</p>

<p><strong>The Firewall</strong></p>

<p>My old firewall was a Soekris net4801 appliance (circa 2003) running m0n0wall. &nbsp;It protected my home network for ten years, never once crashing. &nbsp; The only real problem with it was that it can no longer keep up with modern home Internet speeds. &nbsp;</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/soekris.jpg" />
    
    
    <figcaption>
        <h4>Soekris net4801</h4>
        
    </figcaption>
    
</figure>


<p>These days, we have a 35 Mbps connection at the house but the Soekris tops out at a little over 21 Mbps. &nbsp;When it maxed out its power, packets would drop and the Internet got flakey. &nbsp;I wanted something that could handle 100+ Mbps with ease. &nbsp; This new machine, with its four-port server-grade Intel NIC was the ticket. &nbsp;With a tiny 1 VCPU, 1 GB VRAM virtual machine running pfSense, I can now push data as fast as Comcast will allow.</p>

<p>The old Soekris firewall:</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/speedtest_soekris.jpg" />
    
    
</figure>


<p>The new, virtualized pfSense firewall:</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/speedtest_pfsense.jpg" />
    
    
</figure>


<p>The trickest part about running a firewall under ESXi is getting the networking correct. &nbsp;The best (and in my opinion, most secure) way to do this is to use dedicated NICs for each network. &nbsp;I use one port for my WAN (cable modem) and another for the LAN (internal private network). &nbsp; I have another network, the DMZ, for servers that I don&rsquo;t trust enough to run on the private network. &nbsp;The Backtrack Linux VM goes here. &nbsp;I use ESXi&rsquo;s virtual switching to connect VMs to NICs:</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/vSwitch.jpg" />
    
    
</figure>


<p>The arrangement works well. &nbsp;I get great throughput on the firewall and moving a machine between networks takes only a couple of mouse clicks.</p>

<p><strong>Backtrack Server (My Very Own Evil Mad Scientist Laboratory)</strong></p>


<figure >
    
        <img src="https://chrissnell.com/images/post/backtrack-linux-logo.png" />
    
    
</figure>


<p>I&rsquo;ve been playing around with <a href="http://backtrack-linux.org">Backtrack Linux</a> for a while now. &nbsp;For those that don&rsquo;t know, Backtrack is a Linux operating system designed for electronic security work. &nbsp; It comes with a massive selection of exploitation, forensics, snooping, and analysis tools pre-installed. &nbsp;If you were so inclined, Backtrack has most of what you need to break into networks and cause major havoc. &nbsp;For its more altrustic users, it&rsquo;s a outstanding toolkit to test your network&rsquo;s security. &nbsp; Ever wonder if someone can crack your WiFi key and snoop around on your home PC? &nbsp;Backtrack has the tools you need to find out. &nbsp;By running exploits against your own network and understanding its vulnerabilities, you can better secure your data.</p>

<p>One of my favorite tools on BT is <a href="http://code.google.com/p/pyrit/">Pyrit</a>. &nbsp;Pyrit is an open-source password cracker capable of cracking WEP, WPA, and WPA2 passwords for WiFi networks. &nbsp;The superhero power of Pyrit is its ability to use your computer&rsquo;s graphics card (GPU) to greatly accelerate the speed of password cracking. &nbsp; A good GPU (like my ATI HD7970) can test passwords <em>hundreds of times faster</em> than the average PC CPU. &nbsp;With this kind of power, it&rsquo;s possible to bruteforce crack a password in a few days that might have taken years to crack on a conventional PC. &nbsp;On an even more sinister note, Pyrit allows you to cluster multiple GPUs running on multiple servers together, potentially creating a massive password-cracking machine. &nbsp; My ATI HD7970 is the fastest GPU available on the consumer market, yet it only costs $400 on Amazon. &nbsp; Can you imagine what a rogue state like North Korea could do if they got their hands on a few dozen of these cards? &nbsp; A security firm <a href="http://www.techspot.com/news/51044-25-gpu-cluster-can-brute-force-windows-password-in-record-time.html">recently clustered 25 GPUs together</a> and achieved 350 billion password guesses per second&ndash;fast enough to crack <strong>any</strong> Windows password in five and a half hours. &nbsp; Very powerful stuff. &nbsp; Very scary. &nbsp;I had to build my own.</p>

<p>The biggest challenge I faced in my project was getting the HD7970 to be available to my Backtrack virtual machine. &nbsp; ESXi provides a mechanism called &ldquo;pass-thru&rdquo; that lets you designate a VM to control a device like a GPU. &nbsp; Unfortunately, the mechanism is poorly documented and I spent several days experimenting before I got it to work. &nbsp; In the end, I had to enable pass-thru for the GPU devices and I had to add a line into the VM&rsquo;s .vnx file:</p>

<p><code>pciHole.start = &quot;2853&quot;</code></p>

<p>I won&rsquo;t go into the particulars of how I determined this value but you can find it if you Google around. There&rsquo;s a procedure for editing .vnx files that you&rsquo;ll need to follow. Again, Google it. &nbsp; Once you get the hole &ldquo;punched&rdquo; and pass-thru working, you&rsquo;ll need to install the ATI drivers and SDK on the VM. &nbsp; The biggest problem I ran into is that the newest version of the SDK is needed to support this card, but this newest version is missing some critical libraries that are necessary to get <a href="http://calpp.sourceforge.net/">CAL++</a> and OpenCL working. &nbsp; What I did was install the older (more complete) SDK and then installed the newest version on top of that, which gave me everything I needed. &nbsp; I also had to install the beta release of the ATI drivers because they&rsquo;re the only version that supports the HD7970. &nbsp;Finally (and this was a big, big stumper for me), I realized that I had to be actually running the Xorg X11 server (i.e. displaying a desktop on a monitor) for CAL++ and Pyrit to be able to &ldquo;see&rdquo; the GPU. &nbsp;(Sorry for the tangent there, but I put all that in there to help the next guy who tries to do all of this.)</p>

<p>Once the GPU is working under Backtrack, you can run Pyrit&rsquo;s benchmark and see some dramatic numbers:</p>


<figure >
    
        <img src="https://chrissnell.com/images/post/btlinux_desktop.jpg" />
    
    
    <figcaption>
        <h4>The Backtrack Linux desktop</h4>
        
    </figcaption>
    
</figure>


<p>That first benchmark is my GPU. &nbsp; As you can see, it&rsquo;s over 200x faster than the cores in my server&rsquo;s Intel CPU.</p>

<p><strong>Future Possibilities</strong></p>

<p>My server is not yet perfect. &nbsp;Of all simple things, I haven&rsquo;t yet figured out how to pass my motherboard&rsquo;s USB controller through to the VM, so I can&rsquo;t use a mouse or USB keyboard. &nbsp;Unable to attach my mouse to Backtrack, I eventually came up with the idea to use <a href="synergy-foss.org/">Synergy</a> to share my Mac Pro&rsquo;s mouse and keyboard with the X11 server on the BT VM. &nbsp; Since USB isn&rsquo;t working, I can&rsquo;t attach my Alfa AWUS036H USB wireless adapter to the Backtrack machine, so I can&rsquo;t directly capture WiFi packets on the VM. &nbsp; Instead, I have to use my Macbook Pro to capture the traffic and manually copy the pcap files to the BT VM. &nbsp; In the future, I plan on setting up an IPsec VPN for the house and using the VPN to allow me to access the power of the big GPU from wherever I am in the field. &nbsp; I might even be able to get Pyrix clustering working over the VPN.</p>

<p>The ESXi platform gives me great flexibility for future expansion. &nbsp; If an operating system can run on a modern PC, it can probably run virtualized under ESXi. &nbsp; If I ever have a need for it, I might fire up another VM and install Windows Server for my home network. &nbsp;ESXi can even run Mac OS X! &nbsp;I&rsquo;m super-happy with my decision to consolidate and I&rsquo;m loving my much-less-cluttered office.</p>

			</div>

			
		</div>

  </body>
</html>
